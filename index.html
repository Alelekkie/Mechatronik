<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Logowanie Firebase</title>
<style>
body, html { height:100%; margin:0; display:flex; justify-content:center; align-items:center; font-family:Arial; background:#f5f5f5;}
#loginDiv { background:white; padding:30px 40px; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.2); text-align:center;}
input{width:250px;padding:10px;margin:10px 0;border:1px solid #aaa;border-radius:5px;}
button{width:270px;padding:10px;margin-top:10px;background:#007bff;color:white;border:none;border-radius:5px;cursor:pointer;}
button:hover{background:#0056b3;}
#showPassword{margin-top:5px;cursor:pointer;font-size:0.9em;color:#007bff;background:none;border:none;}
#errorMsg{color:red;margin-top:10px;font-weight:bold;}
#successDiv{display:none;text-align:center;}
</style>
</head>
<body>

<div id="loginDiv">
  <h2>Logowanie</h2>
  <input type="email" id="email" placeholder="Email"><br>
  <input type="password" id="password" placeholder="Hasło"><br>
  <button onclick="login()">Zaloguj</button><br>
  <button id="showPassword" onclick="togglePassword()">Pokaż/Ukryj hasło</button>
  <div id="errorMsg"></div>
</div>

<div id="successDiv"><h1>Udało się! Zalogowano poprawnie.</h1></div>

<!-- Firebase compat -->
<script src="https://www.gstatic.com/firebasejs/9.30.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.30.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.30.0/firebase-firestore-compat.js"></script>

<script>
// INICJALIZACJA
const firebaseConfig = {
  apiKey: "AIzaSyD3XXnIM1gTcfMTj63lgyo8lUuivjPBO-I",
  authDomain: "urlopy-ee985.firebaseapp.com",
  projectId: "urlopy-ee985",
  storageBucket: "urlopy-ee985.appspot.com",
  messagingSenderId: "1054650388220",
  appId: "1:1054650388220:web:3545e54d9305db91e49179"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let currentUser = null;

// POKAŻ/UKRYJ HASŁO
function togglePassword(){
  const pass=document.getElementById("password");
  pass.type = pass.type==="password" ? "text":"password";
}

// LOGOWANIE
async function login(){
  const email=document.getElementById("email").value;
  const password=document.getElementById("password").value;
  const errorMsg=document.getElementById("errorMsg");
  errorMsg.innerText="";

  if(!email || !password){errorMsg.innerText="Podaj email i hasło!"; return;}

  try{
    const userCred = await auth.signInWithEmailAndPassword(email,password);
    currentUser = userCred.user;

    const docSnap = await db.collection("users").doc(currentUser.uid).get();
    let role="employee";
    if(docSnap.exists() && docSnap.data().role==="admin") role="admin";

    document.getElementById("loginDiv").style.display="none";
    document.getElementById("successDiv").style.display="block";

    console.log("Zalogowano jako:", currentUser.email, "rola:", role);

  } catch(err){
    if(err.code==="auth/user-not-found") errorMsg.innerText="Nie znaleziono użytkownika!";
    else if(err.code==="auth/wrong-password") errorMsg.innerText="Błędne hasło!";
    else errorMsg.innerText=err.message;
  }
}

// AUTOMATYCZNE LOGOWANIE
auth.onAuthStateChanged(user=>{
  if(user){
    currentUser=user;
    document.getElementById("loginDiv").style.display="none";
    document.getElementById("successDiv").style.display="block";
  }
});
</script>

</body>
</html>
