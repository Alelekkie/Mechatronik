<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
    <link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="icon.png">

<meta name="theme-color" content="#ff69b4">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>System Urlopowy - Firebase</title>
<style>
body, html {
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
    background: #000; /* ca≈Çe t≈Ço na czarne */
    color: white; /* tekst na bia≈Çy, ≈ºeby by≈Ço czytelnie */
}
/* dni zajƒôte / zatwierdzone */
.taken {
  background: #ff69b4 !important;
  color: white;
  cursor: not-allowed;
}

.container {
    max-width: 900px;
    margin: auto;
    padding: 10px;
    background: black; /* t≈Ço samego kontenera ciemniejsze, ale nie czarne jak body */
}#email {
    width: 250px;
    padding: 12px 15px;
    border-radius: 25px;      /* ≈Çadnie zaokrƒÖglone */
    border: 2px solid #ff69b4; /* r√≥≈ºowa ramka */
    background: #000;         /* czarne t≈Ço wewnƒÖtrz */
    color: white;             /* tekst wpisywany na bia≈Ço */
    font-size: 16px;
    outline: none;            /* usuwa standardowy focus outline */
}

#email::placeholder {
    color: #ff69b4;           /* r√≥≈ºowy placeholder */
    opacity: 1;                /* ≈ºeby kolor by≈Ç wyra≈∫ny */
}

/* efekt po klikniƒôciu/focus */
#email:focus {
    border-color: #ff1493;    /* ciemniejszy r√≥≈ºowy przy focusie */
    box-shadow: 0 0 5px #ff1493;
}

    #password {
    width: 250px;
    padding: 12px 15px;
    border-radius: 25px;      /* ≈Çadnie zaokrƒÖglone */
    border: 2px solid #ff69b4; /* r√≥≈ºowa ramka */
    background: #000;         /* czarne t≈Ço wewnƒÖtrz */
    color: white;             /* tekst wpisywany na bia≈Ço */
    font-size: 16px;
    outline: none;            /* usuwa standardowy focus outline */
}

#password::placeholder {
    color: #ff69b4;           /* r√≥≈ºowy placeholder */
    opacity: 1;                /* ≈ºeby kolor by≈Ç wyra≈∫ny */
}

/* efekt po klikniƒôciu/focus */
#password:focus {
    border-color: #ff1493;    /* ciemniejszy r√≥≈ºowy przy focusie */
    box-shadow: 0 0 5px #ff1493;
}
    
    
    #vacationDays {
    width: 217px;
    padding: 12px 15px;
    border-radius: 25px;      /* ≈Çadnie zaokrƒÖglone */
    border: 2px solid #ff69b4; /* r√≥≈ºowa ramka */
    background: #000;         /* czarne t≈Ço wewnƒÖtrz */
    color: white;             /* tekst wpisywany na bia≈Ço */
    font-size: 16px;
    outline: none;            /* usuwa standardowy focus outline */
}

#vacationDays::placeholder {
    color: #ff69b4;           /* r√≥≈ºowy placeholder */
    opacity: 1;                /* ≈ºeby kolor by≈Ç wyra≈∫ny */
}

/* efekt po klikniƒôciu/focus */
#vacationDays:focus {
    border-color: #ff1493;    /* ciemniejszy r√≥≈ºowy przy focusie */
    box-shadow: 0 0 5px #ff1493;
}
    
 #taskDays {
    width: 217px;
    padding: 12px 15px;
    border-radius: 25px;      /* ≈Çadnie zaokrƒÖglone */
    border: 2px solid #ff69b4; /* r√≥≈ºowa ramka */
    background: #000;         /* czarne t≈Ço wewnƒÖtrz */
    color: white;             /* tekst wpisywany na bia≈Ço */
    font-size: 16px;
    outline: none;            /* usuwa standardowy focus outline */
}

#taskDays::placeholder {
    color: #ff69b4;           /* r√≥≈ºowy placeholder */
    opacity: 1;                /* ≈ºeby kolor by≈Ç wyra≈∫ny */
}

/* efekt po klikniƒôciu/focus */
#taskDays:focus {
    border-color: #ff1493;    /* ciemniejszy r√≥≈ºowy przy focusie */
    box-shadow: 0 0 5px #ff1493;
}
    
    #employeeSelect {
    width: 250px;
    padding: 12px 15px;
    border-radius: 25px;      /* ≈Çadnie zaokrƒÖglone */
    border: 2px solid #ff69b4; /* r√≥≈ºowa ramka */
    background: #000;         /* czarne t≈Ço wewnƒÖtrz */
    color: white;             /* tekst wpisywany na bia≈Ço */
    font-size: 16px;
    outline: none;            /* usuwa standardowy focus outline */
}

#employeeSelect::placeholder {
    color: #ff69b4;           /* r√≥≈ºowy placeholder */
    opacity: 1;                /* ≈ºeby kolor by≈Ç wyra≈∫ny */
}

/* efekt po klikniƒôciu/focus */
#employeeSelect:focus {
    border-color: #ff1493;    /* ciemniejszy r√≥≈ºowy przy focusie */
    box-shadow: 0 0 5px #ff1493;
}
   
    
     #leaveType {
    width: 250px;
    padding: 12px 15px;
    border-radius: 25px;      /* ≈Çadnie zaokrƒÖglone */
    border: 2px solid #ff69b4; /* r√≥≈ºowa ramka */
    background: #000;         /* czarne t≈Ço wewnƒÖtrz */
    color: white;             /* tekst wpisywany na bia≈Ço */
    font-size: 16px;
    outline: none;            /* usuwa standardowy focus outline */
}

#leaveType::placeholder {
    color: #ff69b4;           /* r√≥≈ºowy placeholder */
    opacity: 1;                /* ≈ºeby kolor by≈Ç wyra≈∫ny */
}

/* efekt po klikniƒôciu/focus */
#leaveType:focus {
    border-color: #ff1493;    /* ciemniejszy r√≥≈ºowy przy focusie */
    box-shadow: 0 0 5px #ff1493;
}
    
    
  table button {
  padding: 0;
  margin: 0; /* opcjonalnie, ≈ºeby te≈º marginesy zniknƒô≈Çy */
  border: none; /* je≈õli chcesz te≈º usunƒÖƒá obramowanie */
  background: none; /* opcjonalnie, je≈õli chcesz usunƒÖƒá t≈Ço */
}  
 #monthLabel {
  font-size: 1.2rem;
  font-weight: bold;
  color: white; /* np. r√≥≈ºowy */

  padding: 5px 10px;
  border-radius: 10px;
  text-align: center;
  transition: all 0.3s ease;
}
#calendarHeader {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  font-weight: bold;
  text-align: center;
  margin-bottom: 5px;
}

#calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
}

.day {
  padding: 10px;
  border: 1px solid #ccc;
  text-align: center;
  cursor: pointer;
}

.day.selected {
  background: #6cf;
}

.day.taken {
  background: pink;
  cursor: not-allowed;
}

#loginDiv,#adminDiv,#employeeDiv{display:flex;flex-direction:column;align-items:center;padding:20px;border-radius:10px;margin-top:20px;box-shadow:0 5px 15px rgba(0,0,0,0.2);background: black;}
    
  logoutBtn{padding:10px;margin-top:10px;width:90%;max-width:270px;border:none;border-radius:5px;background:hotpink;color:white;cursor:pointer;}
logoutBtn:hover{background:DeepPink;transition: background 0.7s, border-color 0.7s, color 0.7s;}  
    
#adminDiv,#employeeDiv{display:none;min-height:80vh;width:90%;color:white;}
    
#adminDiv{background: black;}
    
#employeeDiv{background:black;}
input,select{padding:10px;margin:5px 0;width:90%;max-width:250px;border-radius:5px;border:1px solid #aaa;}
button{padding:10px;margin-top:10px;width:90%;max-width:270px;border:none;border-radius:5px;background:hotpink;color:white;cursor:pointer;}
button:hover{background:DeepPink;transition: background 0.7s, border-color 0.7s, color 0.7s;}
#errorMsg{color:red;font-weight:bold;margin-top:5px;}
#calendarControls{display:flex;justify-content:space-between;width:100%;max-width:300px;margin-top:10px;}
#calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:5px;margin-top:10px;width:100%;}
.day{aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;cursor:pointer;border:1px solid #888;background:#222;}
.selected{background:lightgreen;}
table{border-collapse:collapse;width:100%;margin-top:10px;color:white;}
table,th,td{padding:5px;text-align:center;}
.approved{background:linear-gradient(90deg, #a8e6cf, #56ab2f, #379237); !important;}
.rejected{background:linear-gradient(90deg, #ff9a9e, #f54ea2, #ff0066); !important;}

@media(max-width:500px){input,select,button{width:100%;} #calendar{grid-template-columns:repeat(7,1fr);}}
</style>
</head>
<body>
<div class="container">
  <!-- LOGIN -->
  <div id="loginDiv">
    <h2>Logowanie</h2>
    <input type="text" id="email" placeholder="Imiƒô">
    <input type="password" id="password" placeholder="Has≈Ço">
    <button onclick="login()">Zaloguj</button>
    <button onclick="togglePassword()">Poka≈º/Ukryj has≈Ço</button>
    <div id="errorMsg"></div>
  </div>

  <!-- ADMIN -->
  <div id="adminDiv">
    <h2>ADMIN</h2>
    <h3>Przypisz dni urlopowe:</h3>
    <select id="employeeSelect"></select>
    <input type="number" id="taskDays" placeholder="Dni na ≈ºƒÖdanie">
    <input type="number" id="vacationDays" placeholder="Dni wypoczynkowe">
    <button onclick="setEmployeeDays()">Zapisz</button>

    <h3>Wnioski urlopowe:</h3>
    <table id="adminTable">
      <tr><th>Pracownik</th><th>Dni</th><th>Typ</th><th>Status</th><th>Akcja</th></tr>
    </table>
    <button id="logoutBtn" onclick="logout()">Wyloguj</button>
  </div>

  <!-- PRACOWNIK -->
  <div id="employeeDiv">
    <h2>PRACOWNIK</h2>
    <div>Twoje dni: <span id="remainingTaskDays">0</span> URLOP NA ≈ªƒÑDANIE, <span id="remainingVacationDays">0</span> URLOP WYPOCZYNKOWY</div>
    <div id="calendarControls">
      <button onclick="changeMonth(-1)">&lt; Poprzedni</button>
      <span id="monthLabel"></span>
      <button onclick="changeMonth(1)">Nastƒôpny &gt;</button>
    </div>
    <select id="leaveType">
      <option value="na ≈ºƒÖdanie">URLOP NA ≈ªƒÑDANIE</option>
      <option value="wypoczynkowy">URLOP WYPOCZYNKOWY</option>
    </select>
    <div id="calendarWrapper">
  <div id="calendarHeader"></div>
  <div id="calendar"></div>
</div>

    <button onclick="sendVacation()">Wy≈õlij wniosek</button>

    <h3>Twoje wnioski:</h3>
    <table id="employeeTable">
      <tr><th>Dni</th><th>Typ</th><th>Status</th></tr>
    </table>
    <button id="logoutBtn" onclick="logout()">Wyloguj</button>
  </div>
</div>

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const users=[
  {email:"pawel", password:"0909", role:"admin"},
  {email:"justyna", password:"1234", role:"employee"},
  {email:"klaudia", password:"5678", role:"employee"}
];

let currentUser=null, selectedDays=[], currentMonth=new Date().getMonth(), currentYear=new Date().getFullYear();
const monthNames=["Stycze≈Ñ","Luty","Marzec","Kwiecie≈Ñ","Maj","Czerwiec","Lipiec","Sierpie≈Ñ","Wrzesie≈Ñ","Pa≈∫dziernik","Listopad","Grudzie≈Ñ"];

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyD3XXnIM1gTcfMTj63lgyo8lUuivjPBO-I",
  authDomain: "urlopy-ee985.firebaseapp.com",
  projectId: "urlopy-ee985",
  storageBucket: "urlopy-ee985.firebasestorage.app",
  messagingSenderId: "1054650388220",
  appId: "1:1054650388220:web:3545e54d9305db91e49179",
  measurementId: "G-S3KDP408JF"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Initialize employees in Firebase if not exists
async function initEmployees() {
  for (let u of users.filter(u=>u.role==="employee")) {
    const doc = await db.collection("employees").doc(u.email).get();
    if(!doc.exists) {
      await db.collection("employees").doc(u.email).set({task:5, vacation:15});
    }
  }
}
initEmployees();

function togglePassword(){
  const pass=document.getElementById("password");
  pass.type=pass.type==="password"?"text":"password";
}

async function login(){
  const email=document.getElementById("email").value.trim();
  const password=document.getElementById("password").value.trim();
  const errorMsg=document.getElementById("errorMsg");
  errorMsg.innerText="";
  if(!email||!password){ errorMsg.innerText="Wpisz login i has≈Ço!"; return; }
  const user=users.find(u=>u.email===email && u.password===password);
  if(user){
    currentUser=user;
    document.getElementById("loginDiv").style.display="none";
    if(user.role==="admin"){
      document.getElementById("adminDiv").style.display="flex";
      loadEmployeeOptions(); loadAdminRequests();
    } else {
      document.getElementById("employeeDiv").style.display="flex";
      await loadEmployeeDays(); buildCalendar(); loadEmployeeRequests();
    }
  } else errorMsg.innerText="B≈Çƒôdne dane logowania!";
}

function logout(){
  currentUser=null; selectedDays=[];
  document.getElementById("loginDiv").style.display="flex";
  document.getElementById("adminDiv").style.display="none";
  document.getElementById("employeeDiv").style.display="none";
  document.getElementById("password").value="";
  document.getElementById("errorMsg").innerText="";
}

// --- Admin ---
async function loadEmployeeOptions(){
  const select=document.getElementById("employeeSelect");
  select.innerHTML="";
  const snapshot = await db.collection("employees").get();
  snapshot.forEach(doc=>{
    const opt=document.createElement("option");
    opt.value=doc.id; opt.innerText=doc.id;
    select.appendChild(opt);
  });
}

async function setEmployeeDays(){
  const email=document.getElementById("employeeSelect").value;
  const taskDays=parseInt(document.getElementById("taskDays").value)||0;
  const vacDays=parseInt(document.getElementById("vacationDays").value)||0;
  await db.collection("employees").doc(email).set({task:taskDays, vacation:vacDays});
  alert("Zapisano dni dla "+email);
  loadEmployeeOptions();
}

async function loadAdminRequests(){
  const table=document.getElementById("adminTable");
  table.innerHTML="<tr><th>Pracownik</th><th>Dni</th><th>Typ</th><th>Status</th><th>Akcja</th></tr>";
  const snapshot = await db.collection("vacationRequests").get();
  snapshot.forEach(doc=>{
    const r = doc.data();
    const row=table.insertRow();
    row.insertCell(0).innerText=r.user;
    row.insertCell(1).innerText = r.days.map(d => `${d.day} ${monthNames[d.month]}`).join(", ");

    row.insertCell(2).innerText=r.type;
    row.insertCell(3).innerText=r.status;
    if(r.status==="zatwierdzony") row.classList.add("approved");
    if(r.status==="odrzucony") row.classList.add("rejected");
    const cell=row.insertCell(4);
    const btnApp=document.createElement("button"); btnApp.innerText="Zatwierd≈∫"; 
 btnApp.onclick = async ()=>{
  const req = r; // dane wniosku

  const empRef = db.collection("employees").doc(req.user);
  const empSnap = await empRef.get();
  const emp = empSnap.data();

  const daysCount = req.days.length;

  if(req.type === "na ≈ºƒÖdanie"){
    if(emp.task < daysCount){
      alert("Brak dni na ≈ºƒÖdanie!");
      return;
    }
    emp.task -= daysCount;
  } else {
    if(emp.vacation < daysCount){
      alert("Brak dni wypoczynkowych!");
      return;
    }
    emp.vacation -= daysCount;
  }

  await empRef.set(emp);

  await db.collection("vacationRequests").doc(doc.id)
    .update({status:"zatwierdzony"});

  loadAdminRequests();
};

    const btnRej=document.createElement("button"); btnRej.innerText="Odrzuƒá"; btnRej.style.marginLeft="0px"; 
    btnRej.onclick=async ()=>{
      await db.collection("vacationRequests").doc(doc.id).update({status:"odrzucony"});
      loadAdminRequests();
    };
    cell.appendChild(btnApp); cell.appendChild(btnRej);
  });
}

// --- Employee ---
async function loadEmployeeDays(){
  const doc = await db.collection("employees").doc(currentUser.email).get();
  const days = doc.data();
  document.getElementById("remainingTaskDays").innerText=days.task;
  document.getElementById("remainingVacationDays").innerText=days.vacation;
  return days;
}
async function getTakenDays() {
  const taken = [];
  const snapshot = await db.collection("vacationRequests")
    .where("status", "==", "zatwierdzony")
    .where("user", "==", currentUser.email) // tylko zalogowany
    .get();

  snapshot.forEach(doc => {
    const r = doc.data();
    r.days.forEach(d => {
      if(d.month === currentMonth && d.year === currentYear){
        taken.push(d.day);
      }
    });
  });

  return taken;
}


async function buildCalendar(){ 
  const header = document.getElementById("calendarHeader");
  const cal = document.getElementById("calendar");

  header.innerHTML = "";
  cal.innerHTML = "";

  // üî• NAG≈Å√ìWEK DNI TYGODNIA (PN ‚Üí ND)
  const weekDays = ["Pon","Wt","≈ör","Czw","Pt","Sob","Nd"];
  weekDays.forEach(d => {
    const div = document.createElement("div");
    div.innerText = d;
    div.style.textAlign = "center";
    div.style.fontWeight = "bold";
    header.appendChild(div);
  });

  // etykieta miesiƒÖca
  document.getElementById("monthLabel").innerText =
    monthNames[currentMonth] + " " + currentYear;

  const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

  // üî• Dzie≈Ñ tygodnia 1. dnia miesiƒÖca (0 = poniedzia≈Çek)
  let firstDay = new Date(currentYear, currentMonth, 1).getDay();
  firstDay = (firstDay + 6) % 7; // JS: nd=0 ‚Üí my: pn=0

  // üî• PUSTE POLA PRZED 1 DNIEM
  for(let i = 0; i < firstDay; i++){
    const empty = document.createElement("div");
    empty.className = "empty";
    cal.appendChild(empty);
  }

  // üî• ZATWIERDZONE DNI
  const takenDays = await getTakenDays();

  for(let i = 1; i <= daysInMonth; i++){
    const day = document.createElement("div");
    day.className = "day";
    day.innerText = i;

    if(takenDays.includes(i)){
      day.classList.add("taken");
    } else {
      day.onclick = () => {
        if(selectedDays.includes(i)){
          selectedDays = selectedDays.filter(d => d !== i);
          day.classList.remove("selected");
        } else {
          selectedDays.push(i);
          day.classList.add("selected");
        }
      };
    }

    cal.appendChild(day);
  }
}






function changeMonth(delta){
  currentMonth+=delta;
  if(currentMonth<0){currentMonth=11; currentYear--;}
  else if(currentMonth>11){currentMonth=0; currentYear++;}
  buildCalendar();
}

async function sendVacation(){ 
  if(selectedDays.length === 0){
    alert("Zaznacz dni!");
    return;
  }

  const type = document.getElementById("leaveType").value;
  const status = (type === "na ≈ºƒÖdanie") ? "zatwierdzony" : "oczekuje";

  if(type === "na ≈ºƒÖdanie"){
    const empRef = db.collection("employees").doc(currentUser.email);
    const empSnap = await empRef.get();
    const emp = empSnap.data();

    if(emp.task < selectedDays.length){
      alert("Brak dni na ≈ºƒÖdanie!");
      return;
    }

    emp.task -= selectedDays.length;
    await empRef.set(emp);

    // üî• TO BY≈ÅO BRAKUJƒÑCE
    document.getElementById("remainingTaskDays").innerText = emp.task;
  }

  await db.collection("vacationRequests").add({
    user: currentUser.email,
    days: selectedDays.map(d => ({
      day: d,
      month: currentMonth,
      year: currentYear
    })),
    type,
    status
  });

  selectedDays = [];
  buildCalendar();
  loadEmployeeRequests();
}





async function loadEmployeeRequests(){
  const table = document.getElementById("employeeTable");
  table.innerHTML = "<tr><th>Dni</th><th>Typ</th><th>Status</th></tr>";

  const snapshot = await db.collection("vacationRequests").where("user","==",currentUser.email).get();
  snapshot.forEach(doc => {
    const r = doc.data();
    const row = table.insertRow();

    // üî• Bezpieczne mapowanie dni
    let daysText = "";
    if(r.days && r.days.length > 0){
      // sprawdzamy czy dni sƒÖ liczbami (stary format)
      if(typeof r.days[0] === "number"){
        daysText = r.days.map(d => `${d} ${monthNames[r.month]}`).join(", ");
      } else { // nowy format: obiekty {day, month, year}
        daysText = r.days.map(d => `${d.day} ${monthNames[d.month]}`).join(", ");
      }
    }

    row.insertCell(0).innerText = daysText;
    row.insertCell(1).innerText = r.type;
    row.insertCell(2).innerText = r.status;

    if(r.status === "zatwierdzony") row.classList.add("approved");
    if(r.status === "odrzucony") row.classList.add("rejected");
  });
}

</script>
</body>
</html>
